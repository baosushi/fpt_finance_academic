@using CaptstoneProject.Models
@model List<CaptstoneProject.Models.AreaViewModel.CourseRecordViewModel>
@{
    ViewBag.Title = "SemesterManagement";
}

<h2>SemesterManagement</h2>

<div class="content">
    <!-- Start Container -->
    <div class="container-default animate fadeInRight" style="padding-bottom:10px; min-height:700px">
        <div class="panel panel-default">
            <div class="panel-title"><i class="fa fa-user" style="color:green"></i> Your courses </div>
            <form action="@Url.Action("SemesterManagement","Admin")" id="semesterForm">
                <label>Term: </label>
                <select id="semesterSelector" style="width:100px" name="semesterId">
                    @foreach (var item in ViewBag.semList)
                    {
                        <option value="@item.Value">
                            @item.Text
                        </option>
                    }
                </select>
            </form>
            <button type="button" data-toggle="modal" data-target="#course-modal" class="btn btn-default">Create Course</button>
            <div class="modal fade" id="course-modal">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header"><h4>Create Role</h4><button class="close" data-dismiss="modal"><i class="fa fa-times-circle"></i></button></div>
                        <div class="modal-body">
                            <form method="post" action="@Url.Action("CreateCourse")">
                                <input type="text" value="" placeholder="Course name" name="courseName"/>
                                <input type="text" value="" placeholder="Class name" name="className"/>
                                <input typeof="text" name="date-picker" value="" />
                                <input type="text" class="hidden" name="startDate" value="" />
                                <input type="text" class="hidden" name="endDate" value="" />

                                <select id="subjectSelector" name="subjectId" data-live-search="true">
                                    @foreach (var item in ViewBag.subjectList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                </select>
                                <select id="teacherSelector" name="teacherId" data-live-search="true">
                                    @foreach (var item in ViewBag.teacherList)
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                </select>
                                <input type="text" class="hidden" name="semesterId" id="semesterId-course-form"/>
                                <button type="submit" class="btn btn-success">Create</button>
                            </form>
                        </div>
                        <div class="modal-footer" data-dismiss="modal"></div>

                    </div>
                </div>
            </div>

            @if (ViewBag.semesterStatus == (int)SememsterStatus.Open)
            {
                <form method="post" action="@Url.Action("LockAllCourseForTeacher","Admin")">
                    <span>
                        <input type="hidden" name="semesterId" value="@ViewBag.selectedSem" />
                        <input class="btn btn-danger" title="Lock edited all teacher of all course in @ViewBag.selectedSemName semester" type="submit" value="LockTeacher" />
                    </span>
                </form>
                <form method="post" action="@Url.Action("LockAllCourseForTrainingMangement","Admin")">
                    <span>
                        <input type="hidden" name="semesterId" value="@ViewBag.selectedSem" />
                        <input class="btn btn-danger" title="Lock edited of all course in @ViewBag.selectedSemName semester" type="submit" value="Lock Semester" />
                    </span>
                </form>
            }
            @if (ViewBag.semesterStatus == (int)SememsterStatus.Closed)
            {
                <form method="post" action="@Url.Action("UnlockSemester","Admin")">
                    <span>
                        <input type="hidden" name="semesterId" value="@ViewBag.selectedSem" />
                        <input class="btn btn-danger" title="Lock edited of all course in @ViewBag.selectedSemName semester" type="submit" value="Lock Semester" />
                    </span>
                </form>
            }



            <div class="panel-body table-responsive">
                <table id="testTable" class="table display dataTable">
                    <thead>
                        <tr>
                            <th>No.</th>
                            <th>Course Name</th>
                            <th>Course Code</th>
                            <th>Class</th>
                            <th>Date</th>
                            <th>Action</th>
                            <th>Status</th>
                            <th>Status Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 1; i <= this.Model.Count; i++)
                        {
                            <tr>
                                <td>@i</td>
                                <td>@Model[i - 1].Name</td>
                                <td>@Model[i - 1].Code</td>
                                <td>@Model[i - 1].Class</td>
                                <td>From @Model[i - 1].StartDate.ToString("dd/MM/yyyy") to @Model[i - 1].EndDate.ToString("dd/MM/yyyy")</td>
                                <td><a href="@Url.Action("CourseDetails", "Admin", new { courseId = Model[i - 1].CourseId , semesterId = ViewBag.selectedSem })">View course</a></td>
                                <td>
                                    @if (Model[i - 1].Status.Equals("Open"))
                                    {
                                        <i style="background-color:#6dc16d;" class="col-md-2 p-2 status">@Model[i - 1].Status</i>
                                    }
                                    else
                                    {
                                        <i style="background-color:#ef7470;" class="col-md-2 p-2 status">@Model[i - 1].Status</i>
                                    }
                                </td>
                                <td></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        var selectedSem = '@ViewBag.selectedSem';
        if (selectedSem != -1 && selectedSem != '') {
            $('#semesterSelector').val(selectedSem);
        }
        $('#semesterId-course-form').val($('#semesterSelector').val());



        $(window).load(function () {


            $("#semesterSelector").selectpicker();
            $("#subjectSelector").selectpicker();
            $("#teacherSelector").selectpicker();

            $('input[name="date-picker"]').daterangepicker({
                showDropdowns: true,
                locale: {
                    format: "DD/MM/YYYY"
                },
                "opens": "center",
                startDate: moment(),
                endDate: moment().add(1,'days')
            },
                function (start, end, label) {
                    $("input[name='startDate']").val(start.format("DD/MM/YYYY"));
                    $("input[name='endDate']").val(end.format("DD/MM/YYYY"));
                }
            );

            $("input[name='startDate']").val(moment().format("DD/MM/YYYY"));
            $("input[name='endDate']").val(moment().add(1, "days").format("DD/MM/YYYY"));


            $('#testTable').DataTable({
                "searching": true,
                "columnDefs": [
                    { "className": "dt-center", "targets": "_all" },
                    { "Sortable": false, "Targets": [0, 1, 2, 3, 4, 5, 6, 7, 8] }
                ]
            });

        });





        $("#semesterSelector").on('change', function () {
            @*$.ajax({
                url: '@Url.Action("Index","Admin")',
                data: { semesterId: $('#semesterSelector').val() },
                type: "POST",
                success: function (result) {

                },
                error: function (error) {
                    alert("Error, please try again later.");
                }
            });*@
            $('#semesterId-course-form').val($('#semesterSelector').val());

            $('#semesterForm').submit();
        });
    });
</script>